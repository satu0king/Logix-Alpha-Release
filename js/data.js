function newCircuit(_0x2e01x1,_0x2e01x2){_0x2e01x1= _0x2e01x1|| prompt("Enter circuit name:");var _0x2e01x3= new Scope(_0x2e01x1);if(_0x2e01x2){_0x2e01x3["id"]= _0x2e01x2};scopeList[_0x2e01x3["id"]]= _0x2e01x3;globalScope= _0x2e01x3;if(!embed){$(".circuits")["removeClass"]("current");$("#tabsBar")["append"]("<div class='circuits toolbarButton current' id='"+ _0x2e01x3["id"]+ "'>"+ _0x2e01x1+ "</div>");$(".circuits")["click"](function(){switchCircuit(this["id"])});showProperties(_0x2e01x3["root"])};dots(true,false);return _0x2e01x3}function changeCircuitName(_0x2e01x1,_0x2e01x2= globalScope["id"]){$("#"+ _0x2e01x2)["html"](_0x2e01x1);scopeList[_0x2e01x2]["name"]= _0x2e01x1}function setProjectName(_0x2e01x1){projectName= _0x2e01x1;$("#projectName")["html"](_0x2e01x1)}function clearProject(){globalScope= undefined;scopeList= {};$(".circuits")["remove"]();newCircuit("main");showMessage("Your project is as good as new!")}function newProject(_0x2e01x8){if(_0x2e01x8|| projectSaved||  !checkToSave()|| confirm("What you like to start a new project? Any unsaved chanegs will be lost.")){clearProject();projectName= undefined;projectId= generateId();showMessage("New Project has been created!")}}function generateSvg(){resolution= 1;view= "full";var _0x2e01xa=globalScope["ox"];var _0x2e01xb=globalScope["oy"];var _0x2e01xc=width;var _0x2e01xd=height;var _0x2e01xe=globalScope["scale"];backUpContextBackground= backgroundArea["context"];backUpContextSimulation= simulationArea["context"];backgroundArea["context"]= simulationArea["context"];globalScope["ox"]*= resolution/ _0x2e01xe;globalScope["oy"]*= resolution/ _0x2e01xe;globalScope["scale"]= resolution;var _0x2e01x3=globalScope;console["log"]("DIM:",width,height);if(view== "full"){var _0x2e01xf=10000000;var _0x2e01x10=10000000;var _0x2e01x11=-10000000;var _0x2e01x12=-10000000;var _0x2e01x13=0;for(var _0x2e01x14=0;_0x2e01x14< _0x2e01x3["objects"]["length"];_0x2e01x14++){for(var _0x2e01x15=0;_0x2e01x15< _0x2e01x3[_0x2e01x3["objects"][_0x2e01x14]]["length"];_0x2e01x15++){if(_0x2e01x3[_0x2e01x3["objects"][_0x2e01x14]][_0x2e01x15]["objectType"]!== "Wire"){console["log"]("obj:",_0x2e01x3[_0x2e01x3["objects"][_0x2e01x14]][_0x2e01x15]);_0x2e01xf= Math["min"](_0x2e01xf,_0x2e01x3[_0x2e01x3["objects"][_0x2e01x14]][_0x2e01x15]["absX"]());_0x2e01x11= Math["max"](_0x2e01x11,_0x2e01x3[_0x2e01x3["objects"][_0x2e01x14]][_0x2e01x15]["absX"]());_0x2e01x10= Math["min"](_0x2e01x10,_0x2e01x3[_0x2e01x3["objects"][_0x2e01x14]][_0x2e01x15]["absY"]());_0x2e01x12= Math["max"](_0x2e01x12,_0x2e01x3[_0x2e01x3["objects"][_0x2e01x14]][_0x2e01x15]["absY"]());_0x2e01x13= Math["max"](_0x2e01x13,_0x2e01x3[_0x2e01x3["objects"][_0x2e01x14]][_0x2e01x15]["leftDimensionX"]);_0x2e01x13= Math["max"](_0x2e01x13,_0x2e01x3[_0x2e01x3["objects"][_0x2e01x14]][_0x2e01x15]["rightDimensionX"]);_0x2e01x13= Math["max"](_0x2e01x13,_0x2e01x3[_0x2e01x3["objects"][_0x2e01x14]][_0x2e01x15]["upDimensionY"]);_0x2e01x13= Math["max"](_0x2e01x13,_0x2e01x3[_0x2e01x3["objects"][_0x2e01x14]][_0x2e01x15]["downDimensionY"])}}};width= (_0x2e01x11- _0x2e01xf+ 2* _0x2e01x13+ 26)* resolution;height= (_0x2e01x12- _0x2e01x10+ 2* _0x2e01x13+ 26)* resolution;globalScope["ox"]= (-_0x2e01xf+ _0x2e01x13 + 13) * resolution;globalScope["oy"]= (-_0x2e01x10+ _0x2e01x13 + 13) * resolution}else {width= (width* resolution)/ _0x2e01xe;height= (height* resolution)/ _0x2e01xe};console["log"]("DIM:",width,height);globalScope["ox"]= Math["round"](globalScope["ox"]);globalScope["oy"]= Math["round"](globalScope["oy"]);simulationArea["canvas"]["width"]= width;simulationArea["canvas"]["height"]= height;backgroundArea["canvas"]["width"]= width;backgroundArea["canvas"]["height"]= height;simulationArea["context"]=  new C2S(width,height);backgroundArea["context"]= simulationArea["context"];simulationArea["clear"]();for(var _0x2e01x14=0;_0x2e01x14< _0x2e01x3["objects"]["length"];_0x2e01x14++){for(var _0x2e01x15=0;_0x2e01x15< _0x2e01x3[_0x2e01x3["objects"][_0x2e01x14]]["length"];_0x2e01x15++){_0x2e01x3[_0x2e01x3["objects"][_0x2e01x14]][_0x2e01x15]["draw"]()}};var _0x2e01x16=simulationArea["context"]["getSerializedSvg"]();download("test.svg",_0x2e01x16);width= _0x2e01xc;height= _0x2e01xd;console["log"]("DIM:",width,height);simulationArea["canvas"]["width"]= width;simulationArea["canvas"]["height"]= height;backgroundArea["canvas"]["width"]= width;backgroundArea["canvas"]["height"]= height;globalScope["scale"]= _0x2e01xe;backgroundArea["context"]= backUpContextBackground;simulationArea["context"]= backUpContextSimulation;globalScope["ox"]= _0x2e01xa;globalScope["oy"]= _0x2e01xb;updateSimulation= true;updateCanvas= true;scheduleUpdate();dots(true,false)}function switchCircuit(_0x2e01x2){scheduleBackup();console["log"](_0x2e01x2);if(_0x2e01x2== globalScope["id"]){return};$("#"+ globalScope["id"])["removeClass"]("current");$("#"+ _0x2e01x2)["addClass"]("current");simulationArea["lastSelected"]= undefined;simulationArea["multipleObjectSelections"]= [];simulationArea["copyList"]= [];globalScope= scopeList[_0x2e01x2];updateSimulation= true;scheduleBackup();undo();dots(true,false)}function saveAsImg(_0x2e01x1,_0x2e01x19){var _0x2e01x1a=simulationArea["canvas"]["toDataURL"]("image/"+ _0x2e01x19);var _0x2e01x1b=document["createElement"]("a");_0x2e01x1b["href"]= _0x2e01x1a;_0x2e01x1b["download"]= _0x2e01x1+ "."+ _0x2e01x19;_0x2e01x1b["click"]()}function undo(_0x2e01x3= globalScope){if(_0x2e01x3["backups"]["length"]== 0){return};var _0x2e01x1d=globalScope["ox"];var _0x2e01x1e=globalScope["oy"];var _0x2e01x1f=globalScope["scale"];globalScope["ox"]= 0;globalScope["oy"]= 0;tempScope=  new Scope(_0x2e01x3["name"]);loading= true;loadScope(tempScope,JSON["parse"](_0x2e01x3["backups"]["pop"]()));tempScope["backups"]= _0x2e01x3["backups"];tempScope["id"]= _0x2e01x3["id"];tempScope["name"]= _0x2e01x3["name"];scopeList[_0x2e01x3["id"]]= tempScope;globalScope= tempScope;globalScope["ox"]= _0x2e01x1d;globalScope["oy"]= _0x2e01x1e;globalScope["scale"]= _0x2e01x1f;loading= false}function extract(_0x2e01x21){return _0x2e01x21["saveObject"]()}function checkIfBackup(_0x2e01x3){for(var _0x2e01x14=0;_0x2e01x14< _0x2e01x3["objects"]["length"];_0x2e01x14++){if(_0x2e01x3[_0x2e01x3["objects"][_0x2e01x14]]["length"]){return true}};return false}function scheduleBackup(_0x2e01x3= globalScope){if(!checkIfBackup(_0x2e01x3)){return};var _0x2e01x24=JSON["stringify"](backUp(_0x2e01x3));if(_0x2e01x3["backups"]["length"]== 0|| _0x2e01x3["backups"][_0x2e01x3["backups"]["length"]- 1]!= _0x2e01x24){_0x2e01x3["backups"]["push"](_0x2e01x24);_0x2e01x3["timeStamp"]=  new Date()["getTime"]();projectSaved= false};return _0x2e01x24}function generateId(){var _0x2e01x2="";var _0x2e01x26="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(var _0x2e01x14=0;_0x2e01x14< 20;_0x2e01x14++){_0x2e01x2+= _0x2e01x26["charAt"](Math["floor"](Math["random"]()* _0x2e01x26["length"]))};return _0x2e01x2}function backUp(_0x2e01x3= globalScope){var _0x2e01x28={};_0x2e01x28["allNodes"]= _0x2e01x3["allNodes"]["map"](extract);_0x2e01x28["id"]= _0x2e01x3["id"];_0x2e01x28["name"]= _0x2e01x3["name"];for(var _0x2e01x14=0;_0x2e01x14< moduleList["length"];_0x2e01x14++){if(_0x2e01x3[moduleList[_0x2e01x14]]["length"]){_0x2e01x28[moduleList[_0x2e01x14]]= _0x2e01x3[moduleList[_0x2e01x14]]["map"](extract)}};_0x2e01x28["nodes"]= [];for(var _0x2e01x14=0;_0x2e01x14< _0x2e01x3["nodes"]["length"];_0x2e01x14++){_0x2e01x28["nodes"]["push"](_0x2e01x3["allNodes"]["indexOf"](_0x2e01x3["nodes"][_0x2e01x14]))};return _0x2e01x28}function generateDependencyOrder(){var _0x2e01x2a={};var _0x2e01x2b={};for(id in scopeList){_0x2e01x2a[id]= scopeList[id]["getDependencies"]()};function _0x2e01x2c(_0x2e01x2){if(_0x2e01x2b[_0x2e01x2]){return};for(var _0x2e01x14=0;_0x2e01x14< _0x2e01x2a[_0x2e01x2]["length"];_0x2e01x14++){_0x2e01x2c(_0x2e01x2a[_0x2e01x2][_0x2e01x14])};_0x2e01x2b[_0x2e01x2]= true;data["scopes"]["push"](_0x2e01x2)}}function generateSaveData(_0x2e01x1){data= {};data["name"]= projectName|| _0x2e01x1|| prompt("Enter Project Name:")|| "Untitled";projectName= data["name"];data["timePeriod"]= simulationArea["timePeriod"];data["projectId"]= projectId;data["authorName"]= authorName|| prompt("Enter author name: ");authorName= data["authorName"];data["scopes"]= [];var _0x2e01x2a={};var _0x2e01x2b={};for(id in scopeList){_0x2e01x2a[id]= scopeList[id]["getDependencies"]()};function _0x2e01x2c(_0x2e01x2){if(_0x2e01x2b[_0x2e01x2]){return};for(var _0x2e01x14=0;_0x2e01x14< _0x2e01x2a[_0x2e01x2]["length"];_0x2e01x14++){_0x2e01x2c(_0x2e01x2a[_0x2e01x2][_0x2e01x14])};_0x2e01x2b[_0x2e01x2]= true;data["scopes"]["push"](backUp(scopeList[_0x2e01x2]));console["log"]("SAVING:",scopeList[_0x2e01x2]["name"],_0x2e01x2)}for(id in scopeList){_0x2e01x2c(id)};data= JSON["stringify"](data);return data}function save(){projectSaved= true;var _0x2e01x28=generateSaveData();var _0x2e01x2f= new XMLHttpRequest();_0x2e01x2f["open"]("POST","./index.php",true);_0x2e01x2f["setRequestHeader"]("Content-type","application/x-www-form-urlencoded");var _0x2e01x30=jQuery["param"]({data:_0x2e01x28,projectName:projectName,authorName:authorName});console["log"](_0x2e01x30);_0x2e01x2f["send"](_0x2e01x30);_0x2e01x2f["onload"]= function(){window["location"]["hash"]= _0x2e01x2f["responseText"];showMessage("We have saved your project: "+ projectName+ " in our servers.")}}function load(_0x2e01x28){projectId= _0x2e01x28["projectId"];projectName= _0x2e01x28["name"];authorName= _0x2e01x28["authorName"];if(_0x2e01x28["name"]== "Untitled"){projectName= undefined}else {setProjectName(_0x2e01x28["name"])};globalScope= undefined;scopeList= {};if(!embed){$(".circuits")["remove"]()};for(var _0x2e01x14=0;_0x2e01x14< _0x2e01x28["scopes"]["length"];_0x2e01x14++){var _0x2e01x3=newCircuit(_0x2e01x28["scopes"][_0x2e01x14]["name"],_0x2e01x28["scopes"][_0x2e01x14]["id"]);loadScope(_0x2e01x3,_0x2e01x28["scopes"][_0x2e01x14])};simulationArea["changeClockTime"](_0x2e01x28["timePeriod"]|| 500);updateSimulation= true;updateCanvas= true;scheduleUpdate()}function rectifyObjectType(_0x2e01x21){var _0x2e01x33={"FlipFlop":"DflipFlop","Ram":"Rom"};return _0x2e01x33[_0x2e01x21]|| _0x2e01x21}

function loadModule(data, scope) {
    // console.log(data);
    // console.log(data["objectType"])
    obj = new window[rectifyObjectType(data["objectType"])](data["x"], data["y"], scope, ...data.customData["constructorParamaters"] || []);
    obj.label = data["label"];
    obj.labelDirection = data["labelDirection"] || oppositeDirection[fixDirection[obj.direction]];
    obj.fixDirection();
    if (data.customData["values"])
        for (prop in data.customData["values"]) {
            obj[prop] = data.customData["values"][prop];
        }
    if (data.customData["nodes"])
        for (node in data.customData["nodes"]) {
            var n = data.customData["nodes"][node]
            if (n instanceof Array) {
                for (var i = 0; i < n.length; i++) {
                    // console.log(obj[node],obj[node][i],i);
                    obj[node][i] = replace(obj[node][i], n[i]);
                }
            } else {
                obj[node] = replace(obj[node], n);
            }
        }

}

function download(_0x88a3x1,_0x88a3x2){var _0x88a3x3=document["createElement"]("a");_0x88a3x3["setAttribute"]("href","data:text/plain;charset=utf-8,"+ encodeURIComponent(_0x88a3x2));_0x88a3x3["setAttribute"]("download",_0x88a3x1);if(document["createEvent"]){var _0x88a3x4=document["createEvent"]("MouseEvents");_0x88a3x4["initEvent"]("click",true,true);_0x88a3x3["dispatchEvent"](_0x88a3x4)}else {_0x88a3x3["click"]()}}function loadScope(_0x88a3x6,_0x88a3x7){var _0x88a3x8=moduleList["slice"]();_0x88a3x8["push"]("FlipFlop");_0x88a3x7["allNodes"]["map"](function(_0x88a3x9){return loadNode(_0x88a3x9,_0x88a3x6)});for(var _0x88a3xa=0;_0x88a3xa< _0x88a3x7["allNodes"]["length"];_0x88a3xa++){constructNodeConnections(_0x88a3x6["allNodes"][_0x88a3xa],_0x88a3x7["allNodes"][_0x88a3xa])};for(var _0x88a3xa=0;_0x88a3xa< _0x88a3x8["length"];_0x88a3xa++){if(_0x88a3x7[_0x88a3x8[_0x88a3xa]]){if(_0x88a3x8[_0x88a3xa]== "SubCircuit"){for(var _0x88a3xb=0;_0x88a3xb< _0x88a3x7[_0x88a3x8[_0x88a3xa]]["length"];_0x88a3xb++){loadSubCircuit(_0x88a3x7[_0x88a3x8[_0x88a3xa]][_0x88a3xb],_0x88a3x6)}}else {for(var _0x88a3xb=0;_0x88a3xb< _0x88a3x7[_0x88a3x8[_0x88a3xa]]["length"];_0x88a3xb++){loadModule(_0x88a3x7[_0x88a3x8[_0x88a3xa]][_0x88a3xb],_0x88a3x6)}}}};_0x88a3x6["wires"]["map"](function(_0x88a3x9){_0x88a3x9["updateData"]()})}createSaveAsImgPrompt= function(_0x88a3x6= globalScope){$("#saveImageDialog")["dialog"]({width:"auto",buttons:[{text:"Render Circuit Image",click:function(){generateImage();$(this)["dialog"]("close")}}]});$("input[name=imgType]")["change"](function(){$("input[name=resolution]")["prop"]("disabled",false);$("input[name=transparent]")["prop"]("disabled",false);var _0x88a3xc=$("input[name=imgType]:checked")["val"]();if(_0x88a3xc== "svg"){$("input[name=resolution][value=1]")["click"]();$("input[name=resolution]")["prop"]("disabled",true)}else {if(_0x88a3xc!= "png"){$("input[name=transparent]")["attr"]("checked",false);$("input[name=transparent]")["prop"]("disabled",true)}}})};createOpenLocalPrompt= function(){$("#openProjectDialog")["empty"]();var _0x88a3xd=JSON["parse"](localStorage["getItem"]("projectList"));var _0x88a3xe=true;for(id in _0x88a3xd){_0x88a3xe= false;$("#openProjectDialog")["append"]("<label class=\"option\"><input type=\"radio\" name=\"projectId\" value=\""+ id+ "\" />"+ _0x88a3xd[id]+ "</label>")};if(_0x88a3xe){$("#openProjectDialog")["append"]("<p>Looks like no circuit has been saved yet. Create a new one and save it!</p>")};$("#openProjectDialog")["dialog"]({width:"auto",buttons:[{text:"Open Project",click:function(){if(!$("input[name=projectId]:checked")["val"]()){return};load(JSON["parse"](localStorage["getItem"]($("input[name=projectId]:checked")["val"]())));$(this)["dialog"]("close")}}]})};createSubCircuitPrompt= function(_0x88a3x6= globalScope){$("#insertSubcircuitDialog")["empty"]();var _0x88a3xe=true;for(id in scopeList){if(!scopeList[id]["checkDependency"](_0x88a3x6["id"])){_0x88a3xe= false;$("#insertSubcircuitDialog")["append"]("<label class=\"option\"><input type=\"radio\" name=\"subCircuitId\" value=\""+ id+ "\" />"+ scopeList[id]["name"]+ "</label>")}};if(_0x88a3xe){$("#insertSubcircuitDialog")["append"]("<p>Looks like there are no other circuits which doesn't have this circuit as a dependency. Create a new one!</p>")};$("#insertSubcircuitDialog")["dialog"]({width:"auto",buttons:[{text:"Insert SubCircuit",click:function(){if(!$("input[name=subCircuitId]:checked")["val"]()){return}; new SubCircuit(undefined,undefined,globalScope,$("input[name=subCircuitId]:checked")["val"]());$(this)["dialog"]("close")}}]})};function saveOffline(){projectSaved= true;var _0x88a3x7=generateSaveData();localStorage["setItem"](projectId,_0x88a3x7);var _0x88a3x10=JSON["parse"](localStorage["getItem"]("projectList"))|| {};_0x88a3x10[projectId]= projectName;localStorage["setItem"]("projectList",JSON["stringify"](_0x88a3x10));showMessage("We have saved your project: "+ projectName+ " in your browser's localStorage")}function checkToSave(){var _0x88a3x12=false;for(id in scopeList){_0x88a3x12|= checkIfBackup(scopeList[id])};return _0x88a3x12}window["onbeforeunload"]= function(){if(projectSaved){return};if(!checkToSave()){return};var _0x88a3x7=generateSaveData("Untitled");localStorage["setItem"]("recover",_0x88a3x7)};function generateImage(){var _0x88a3xc=$("input[name=imgType]:checked")["val"]();var _0x88a3x14=$("input[name=view]:checked")["val"]();var _0x88a3x15=$("input[name=transparent]:checked")["val"]();var _0x88a3x16=$("input[name=resolution]:checked")["val"]();console["log"]($("input[name=imgType]:checked")["val"]());console["log"]($("input[name=view]:checked")["val"]());console["log"]($("input[name=transparent]:checked")["val"]());console["log"]($("input[name=resolution]:checked")["val"]());var _0x88a3x17=globalScope["ox"];var _0x88a3x18=globalScope["oy"];var _0x88a3x19=width;var _0x88a3x1a=height;var _0x88a3x1b=globalScope["scale"];backUpContextBackground= backgroundArea["context"];backUpContextSimulation= simulationArea["context"];backgroundArea["context"]= simulationArea["context"];globalScope["ox"]*= 1/ _0x88a3x1b;globalScope["oy"]*= 1/ _0x88a3x1b;if(_0x88a3xc== "svg"){simulationArea["context"]=  new C2S(width,height);_0x88a3x16= 1}else {if(_0x88a3xc!= "png"){_0x88a3x15= false}};globalScope["scale"]= _0x88a3x16;var _0x88a3x6=globalScope;console["log"]("DIM:",width,height);if(_0x88a3x14== "full"){findDimensions();var _0x88a3x1c=simulationArea["minWidth"];var _0x88a3x1d=simulationArea["minHeight"];var _0x88a3x1e=simulationArea["maxWidth"];var _0x88a3x1f=simulationArea["maxHeight"];width= (_0x88a3x1e- _0x88a3x1c+ 100)* _0x88a3x16;height= (_0x88a3x1f- _0x88a3x1d+ 100)* _0x88a3x16;globalScope["ox"]= (-_0x88a3x1c+ 50) * _0x88a3x16;globalScope["oy"]= (-_0x88a3x1d+ 50) * _0x88a3x16}else {width= (width* _0x88a3x16)/ _0x88a3x1b;height= (height* _0x88a3x16)/ _0x88a3x1b};console["log"]("DIM:",width,height);globalScope["ox"]= Math["round"](globalScope["ox"]);globalScope["oy"]= Math["round"](globalScope["oy"]);simulationArea["canvas"]["width"]= width;simulationArea["canvas"]["height"]= height;backgroundArea["canvas"]["width"]= width;backgroundArea["canvas"]["height"]= height;backgroundArea["context"]= simulationArea["context"];simulationArea["clear"]();if(!_0x88a3x15){simulationArea["context"]["fillStyle"]= "white";simulationArea["context"]["rect"](0,0,width,height);simulationArea["context"]["fill"]()};for(var _0x88a3xa=0;_0x88a3xa< _0x88a3x6["objects"]["length"];_0x88a3xa++){for(var _0x88a3xb=0;_0x88a3xb< _0x88a3x6[_0x88a3x6["objects"][_0x88a3xa]]["length"];_0x88a3xb++){_0x88a3x6[_0x88a3x6["objects"][_0x88a3xa]][_0x88a3xb]["draw"]()}};if(_0x88a3xc== "svg"){var _0x88a3x20=simulationArea["context"]["getSerializedSvg"]();download(globalScope["name"]+ ".svg",_0x88a3x20)}else {saveAsImg(globalScope["name"],_0x88a3xc)};width= _0x88a3x19;height= _0x88a3x1a;console["log"]("DIM:",width,height);simulationArea["canvas"]["width"]= width;simulationArea["canvas"]["height"]= height;backgroundArea["canvas"]["width"]= width;backgroundArea["canvas"]["height"]= height;globalScope["scale"]= _0x88a3x1b;backgroundArea["context"]= backUpContextBackground;simulationArea["context"]= backUpContextSimulation;globalScope["ox"]= _0x88a3x17;globalScope["oy"]= _0x88a3x18;updateSimulation= true;updateCanvas= true;scheduleUpdate();dots(true,false)}
